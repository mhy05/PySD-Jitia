

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced Usage &mdash; PySD 0.3.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PySD 0.3.2 documentation" href="index.html"/>
        <link rel="next" title="User Functions Reference" href="functions.html"/>
        <link rel="prev" title="Basic Usage" href="basic_usage.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> PySD
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-via-pip">Installing via pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-from-source">Installing from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#required-dependencies">Required Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#optional-dependencies">Optional Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#importing-a-model-and-getting-started">Importing a model and getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#running-the-model">Running the Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#outputting-various-run-information">Outputting various run information</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#setting-parameter-values">Setting parameter values</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#setting-simulation-initial-conditions">Setting simulation initial conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#querying-current-values">Querying current values</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html#collecting-a-history-of-returned-values">Collecting a history of returned values</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Advanced Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#replacing-model-components-with-more-complex-objects">Replacing model components with more complex objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supplying-additional-arguments-to-the-integrator">Supplying additional arguments to the integrator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">User Functions Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/development_index.html">Developer Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="development/about.html">About the Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="development/about.html#motivation-the-coming-of-age-of-big-data">Motivation: The (coming of) age of Big Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="development/about.html#general-approaches-for-integrating-system-dynamic-models-and-data-analytics">General approaches for integrating system dynamic models and data analytics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="development/contributing.html">Contributing to PySD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="development/contributing.html#development-tools">Development Tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="development/contributing.html#test-suite">Test Suite</a></li>
<li class="toctree-l4"><a class="reference internal" href="development/contributing.html#speed-tests">Speed Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="development/contributing.html#profiler">Profiler</a></li>
<li class="toctree-l4"><a class="reference internal" href="development/contributing.html#python-linter">Python Linter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="development/contributing.html#pysd-design-philosophy">PySD Design Philosophy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="development/pathway.html">PySD Development Pathway</a><ul>
<li class="toctree-l3"><a class="reference internal" href="development/pathway.html#high-priority">High Priority</a></li>
<li class="toctree-l3"><a class="reference internal" href="development/pathway.html#medium-priority">Medium Priority</a></li>
<li class="toctree-l3"><a class="reference internal" href="development/pathway.html#low-priority">Low Priority</a></li>
<li class="toctree-l3"><a class="reference internal" href="development/pathway.html#not-planned">Not Planned</a></li>
<li class="toctree-l3"><a class="reference internal" href="development/pathway.html#ideas-for-other-projects">Ideas for Other Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="development/pathway.html#current-features">Current Features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="development/structure.html">Structure of the PySD module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="development/structure.html#translation">Translation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="development/vensim_translation.html">Vensim Translation</a></li>
<li class="toctree-l4"><a class="reference internal" href="development/xmile_translation.html">XMILE Translation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="development/structure.html#the-model-class">The model class</a></li>
<li class="toctree-l3"><a class="reference internal" href="development/structure.html#the-pysd-class">The PySD class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="development/internal_functions.html">Internal Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="development/complement.html">Complementary Projects</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">PySD</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Advanced Usage</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/advanced_usage.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="advanced-usage">
<h1>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h1>
<p>The power of PySD, and its motivation for existence, is its ability to tie in to other models and analysis packages in the Python environment. In this section we’ll discuss how those connections happen.</p>
<div class="section" id="replacing-model-components-with-more-complex-objects">
<h2>Replacing model components with more complex objects<a class="headerlink" href="#replacing-model-components-with-more-complex-objects" title="Permalink to this headline">¶</a></h2>
<p>In the last section we saw that a parameter could take on a single value, or a series of values over time, with PySD linearly interpolating between the supplied time-series values. Behind the scenes, PySD is translating that constant or time-series into a function that then goes on to replace the original component in the model. For instance, in the teacup example, the room temperature was originally a function defined through parsing the model file as something similar to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">room_temperature</span><span class="p">():</span>
   <span class="k">return</span> <span class="mi">75</span>
</pre></div>
</div>
<p>However, when we made the room temperature something that varied with time, PySD replaced this function with something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">room_temperature</span><span class="p">():</span>
   <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<p>This drew on the internal state of the system, namely the time t, and the time-series data series that that we wanted to variable to represent. This process of substitution is available to the user, and we can replace functions ourselves, if we are careful.</p>
<p>Because PySD assumes that all components in a model are represented as functions taking no arguments, any component that we wish to modify must be replaced with a function taking no arguments. As the state of the system and all auxiliary or flow methods are public, our replacement function can call these methods as part of its internal structure.</p>
<p>In our teacup example, suppose we didn’t know the functional form for calculating the heat lost to the room, but instead had a lot of data of teacup temperatures and heat flow rates. We could use a regression model (here a support vector regression from Scikit-Learn) in place of the analytic function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="n">regression</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">()</span>
<span class="n">regression</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_training</span><span class="p">,</span> <span class="n">Y_training</span><span class="p">)</span>
</pre></div>
</div>
<p>Once the regression model is fit, we write a wrapper function for its predict method that accesses the input components of the model and formats the prediction for PySD:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">new_heatflow_function</span><span class="p">():</span>
   <span class="sd">&quot;&quot;&quot; Replaces the original flowrate equation</span>
<span class="sd">       with a regression model&quot;&quot;&quot;</span>
   <span class="n">tea_temp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">teacup_temperature</span><span class="p">()</span>
   <span class="n">room_temp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">room_temperature</span><span class="p">()</span>
   <span class="k">return</span> <span class="n">regression</span><span class="o">.</span><span class="n">predict</span><span class="p">([</span><span class="n">room_temp</span><span class="p">,</span> <span class="n">tea_temp</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>We can substitute this function directly for the heat_loss_to_room model component:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">heat_loss_to_room</span> <span class="o">=</span> <span class="n">new_heatflow_function</span>
</pre></div>
</div>
</div>
<div class="section" id="supplying-additional-arguments-to-the-integrator">
<h2>Supplying additional arguments to the integrator<a class="headerlink" href="#supplying-additional-arguments-to-the-integrator" title="Permalink to this headline">¶</a></h2>
<p>the <code class="xref py py-func docutils literal"><span class="pre">run()</span></code> function&#8217;s argument <cite>intg_kwargs</cite> is a pass-through for keyword arguments to scipy&#8217;s odeint function, and as such can take on any of the keywords that odeint recognizes.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="functions.html" class="btn btn-neutral float-right" title="User Functions Reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basic_usage.html" class="btn btn-neutral" title="Basic Usage" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, James Houghton.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>